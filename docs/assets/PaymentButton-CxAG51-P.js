var k=Object.defineProperty;var b=(n,e,t)=>e in n?k(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var m=(n,e,t)=>b(n,typeof e!="symbol"?e+"":e,t);import{r as j,j as r}from"./spline-B5VdbBen.js";import{j as g,l as y,G as C,J as h,A as U}from"./index-8sTTHjsJ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=g("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=g("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);class E{constructor(){m(this,"baseUrl","https://paiement.botagram.fr/api/guest");m(this,"successUrl","https://paiement.botagram.fr/payment/success");m(this,"failedUrl","https://paiement.botagram.fr/payment/failed")}async createPaymentLink(e){var t;try{const a={order:{order_type:"single",currency:e.currency||"EUR",single:{service_id:e.botName,panel_id:void 0,quantity:1,target_url:`https://botagram.fr/bots/${e.botId}`,comments:`Bot d'automatisation pour ${e.botName}`}},payment_method:"dodo",return_url:this.successUrl,cancel_url:this.failedUrl,contact_email:e.contactEmail},s=await fetch(`${this.baseUrl}/checkout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok){const l=await s.json().catch(()=>({}));throw new Error(l.detail||l.message||`HTTP error! status: ${s.status}`)}const i=await s.json();return(t=i.payment)!=null&&t.payment_url?{success:!0,paymentUrl:i.payment.payment_url,orderId:i.public_token}:{success:!1,error:"Failed to create payment link"}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error occurred"}}}handlePaymentSuccess(e){const t=e.get("guest_token"),a=e.get("success"),s=e.get("error");return t&&(a==="true"||!s)?{success:!0,orderId:t}:s?{success:!1,error:s}:{success:!1,error:"Payment status unknown"}}handlePaymentFailure(e){return{success:!1,error:e.get("error")||e.get("reason")||"Payment was cancelled or failed"}}async checkPaymentStatus(e){try{const t=await fetch(`https://paiement.botagram.fr/api/guest/status/${e}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return{success:!0,status:(await t.json()).payment_state}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error occurred"}}}}const $=new E,T=({botId:n,botName:e,price:t,currency:a="EUR",contactEmail:s,variant:i="glow",size:l="md",className:f="",children:w})=>{const[u,p]=j.useState(!1),d=async()=>{p(!0);try{const c={botId:n,botName:e,price:t,currency:a,contactEmail:s},o=await $.createPaymentLink(c);o.success&&o.paymentUrl?window.location.href=o.paymentUrl:h.error(o.error||"Erreur lors de la création du lien de paiement")}catch{h.error("Une erreur est survenue. Veuillez réessayer.")}finally{p(!1)}},x=()=>{switch(l){case"sm":return"h-9 px-4 text-sm";case"lg":return"h-12 px-8 text-base";default:return"h-10 px-6 text-sm"}};return(()=>{const c=`${x()} ${f}`,o=r.jsx(r.Fragment,{children:u?r.jsxs(r.Fragment,{children:[r.jsx(P,{className:"w-4 h-4 mr-2 animate-spin"}),"Création du paiement..."]}):r.jsxs(r.Fragment,{children:[r.jsx(_,{className:"w-4 h-4 mr-2"}),w||`Acheter ${e}`,r.jsx(U,{className:"w-4 h-4 ml-2"})]})});switch(i){case"premium":return r.jsx(y,{variant:"premium",className:c,onClick:d,disabled:u,children:o});case"glow":return r.jsx(C,{className:c,onClick:d,disabled:u,children:o});default:return r.jsx(y,{className:c,onClick:d,disabled:u,children:o})}})()};export{T as P};
