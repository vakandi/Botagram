var k=Object.defineProperty;var b=(n,e,r)=>e in n?k(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r;var m=(n,e,r)=>b(n,typeof e!="symbol"?e+"":e,r);import{k as g,r as j,j as t,m as y,G as C,ad as h,A as P}from"./index-BquvAxLG.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=g("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=g("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);class E{constructor(){m(this,"baseUrl","https://paiement.botagram.fr/api/guest");m(this,"successUrl","https://paiement.botagram.fr/payment/success");m(this,"failedUrl","https://paiement.botagram.fr/payment/failed")}async createPaymentLink(e){var r;try{const s={order:{order_type:"single",currency:e.currency||"EUR",single:{service_id:e.botName,panel_id:void 0,quantity:1,target_url:`https://botagram.fr/bots/${e.botId}`,comments:`Bot d'automatisation pour ${e.botName}`}},payment_method:"dodo",return_url:this.successUrl,cancel_url:this.failedUrl,contact_email:e.contactEmail},a=await fetch(`${this.baseUrl}/checkout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){const l=await a.json().catch(()=>({}));throw new Error(l.detail||l.message||`HTTP error! status: ${a.status}`)}const i=await a.json();return(r=i.payment)!=null&&r.payment_url?{success:!0,paymentUrl:i.payment.payment_url,orderId:i.public_token}:{success:!1,error:"Failed to create payment link"}}catch(s){return console.error("Payment service error:",s),{success:!1,error:s instanceof Error?s.message:"Unknown error occurred"}}}handlePaymentSuccess(e){const r=e.get("guest_token"),s=e.get("success"),a=e.get("error");return r&&(s==="true"||!a)?{success:!0,orderId:r}:a?{success:!1,error:a}:{success:!1,error:"Payment status unknown"}}handlePaymentFailure(e){return{success:!1,error:e.get("error")||e.get("reason")||"Payment was cancelled or failed"}}async checkPaymentStatus(e){try{const r=await fetch(`https://paiement.botagram.fr/api/guest/status/${e}`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return{success:!0,status:(await r.json()).payment_state}}catch(r){return console.error("Payment status check error:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error occurred"}}}}const $=new E,L=({botId:n,botName:e,price:r,currency:s="EUR",contactEmail:a,variant:i="glow",size:l="md",className:f="",children:w})=>{const[u,p]=j.useState(!1),d=async()=>{p(!0);try{const c={botId:n,botName:e,price:r,currency:s,contactEmail:a},o=await $.createPaymentLink(c);o.success&&o.paymentUrl?window.location.href=o.paymentUrl:h.error(o.error||"Erreur lors de la création du lien de paiement")}catch(c){console.error("Payment error:",c),h.error("Une erreur est survenue. Veuillez réessayer.")}finally{p(!1)}},x=()=>{switch(l){case"sm":return"h-9 px-4 text-sm";case"lg":return"h-12 px-8 text-base";default:return"h-10 px-6 text-sm"}};return(()=>{const c=`${x()} ${f}`,o=t.jsx(t.Fragment,{children:u?t.jsxs(t.Fragment,{children:[t.jsx(_,{className:"w-4 h-4 mr-2 animate-spin"}),"Création du paiement..."]}):t.jsxs(t.Fragment,{children:[t.jsx(U,{className:"w-4 h-4 mr-2"}),w||`Acheter ${e}`,t.jsx(P,{className:"w-4 h-4 ml-2"})]})});switch(i){case"premium":return t.jsx(y,{variant:"premium",className:c,onClick:d,disabled:u,children:o});case"glow":return t.jsx(C,{className:c,onClick:d,disabled:u,children:o});default:return t.jsx(y,{className:c,onClick:d,disabled:u,children:o})}})()};export{L as P};
